# Plan 008: Fix Shell Injection Vulnerability in Template Substitution

Created: 2025-01-14T10:00:00Z
Depends: plan-007
Enables: plan-012
Priority: CRITICAL

## Goal

Fix the shell injection vulnerability in the template substitution system where user-controlled input (like file paths) can inject arbitrary shell commands.

## Success Criteria

- Template variables are properly escaped before shell execution
- Malicious input cannot execute arbitrary commands
- Existing functionality remains intact
- Comprehensive tests for injection prevention
- Security documentation updated

## Context

Plan 007 introduced template substitution in ActionExecutor that directly replaces variables in shell commands without escaping. This allows malicious input like `file_path: "/tmp/test.txt; rm -rf /"` to execute multiple commands. This is a critical security vulnerability that must be fixed immediately.

## Security Impact

- **Severity**: Critical
- **Attack Vector**: User-controlled tool input (file paths, commands)
- **Impact**: Arbitrary command execution with cupcake's privileges
- **Affected Component**: `ActionContext::substitute_template()` in `src/engine/actions.rs`